

# 需求分析

## 一、 核心业务需求分析

### 1.  班级与选科管理需求

该模块是教务系统的核心业务之一，核心支撑高二选科分班流程，需满足“全组合独立开班、阈值校验、自主调选”的业务规则。

#### 1.1  基础课程与选科规则

-  课程范围：高中共计9门核心课程，分为3门主科（语文、数学、英语）和6门选科（物理、化学、生物、政治、历史、地理）。
-  高一阶段：全体学生必修9门课程，信息需完整留存，作为学生历史记录。
-  高二阶段：实行选科分班制度，核心规则为「3门主科必选 + 物理/历史二选一 + 政史地生四选二」，最终形成固定选科组合，以该组合为单位独立开班。
-  选科组合范围：共计12种合法选科组合（2种二选一结果 × 6种四选二结果），每种组合对应一个独立的高二固定选科班级。

#### 1.2  开班阈值与选课调整

-  开班阈值：为每种高二选科组合预设最低开班人数阈值，低于该阈值的组合不开班。
-  人数统计：选课期间需实时统计各选科组合的报名学生人数，生成选课人数统计表。
-  调选机制：对于人数低于开班阈值的选科组合，该组合下的学生需重新选择合法选科组合；同时教务主任具备手动调整学生选科组合的权限，保障分班工作顺利推进。

#### 1.3  班级关联与数据留存

-  高一：完整存储行政班的基础信息、学生名单、班主任等数据，高二分班后不删除，作为学生的高一就读历史记录留存。
-  高二/高三：存储选科组合、班主任等信息，建立与学生高一行政班的关联关系，支持追溯学生班级变迁记录。
-  班级类型区分：明确区分“行政班”（高一）与“选科班”（高二/高三），保障业务逻辑的清晰性。

### 2.  权限管理需求

基于「角色-权限」模型，构建清晰的权限体系，满足不同用户的业务操作需求，同时保障数据访问安全，支持角色兼任与权限继承。

#### 2.1  角色定义与核心权限

系统预设5类核心角色，各角色权限边界清晰，具体如下表所示：

| 角色名称 | 核心权限                    | 权限细节补充                                                 |
| -------- | --------------------------- | ------------------------------------------------------------ |
| 学生     | 个人数据查看权              | 可查看本人历次考试的原始分、赋分成绩（如有）。               |
| 班主任   | 班级数据查看权              | 可查看所带班级全体学生的历次考试成绩（所有科目）。           |
| 科任老师 | 授课数据查看权              | 可查看/修改所教课程所有学生的历次考试成绩（仅该门课程）。    |
| 教务主任 | 分班管理+全校数据查看权     | 1.  发起/结束高二学生选课操作；2.  查看各选科组合选课人数统计报表；3.  手动调整人数不足的选科组合（学生调选）；4.  查看全校学生、班级、教职工信息等所有数据。 |
| 校长     | 教职工管理+继承教务主任权限 | 1.  自动继承教务主任的所有权限；2.  能够修改除校长外的教职工的职位/是否离职/所教课程属性 |

#### 2.2  角色兼任规则

-  允许兼任：班主任与科任老师可同时兼任。
-  禁止兼任：校长、教务主任与其他角色不可兼任，避免权限过度集中与业务流程混乱。

#### 2.3  权限继承规则

-  单向继承：仅支持上级角色继承下级角色的权限，核心为「校长自动继承教务主任的所有权限」，无需额外配置。
-  无反向继承：下级角色不继承上级角色的权限（如班主任不继承教务主任权限、教务主任不继承校长权限）。
-  基础角色无继承：学生、班主任、科任老师之间无任何权限继承关系，权限边界相互隔离。

### 3.  考试与成绩管理需求

实现考试信息的分类管理、学生成绩的完整存储、市统考赋分计算，满足高中各类考试的成绩统计与分析需求。

#### 3.1  考试信息管理

-  考试分类：支持标记考试类型，包括月考、期中、期末、市统考等，允许一个考试关联多个类型（如“高二上学期第一次月考+市统考”）。
-  考试属性区分：仅“市统考”类型的考试，需记录各单科的「市排名」与「有效参考总人数」；非市统考考试无需记录这两项数据。
-  考试基础信息：需存储考试编号、考试名称、考试时间、备注等基础信息，保障考试数据的完整性。

#### 3.2  成绩存储规则

-  存储维度：每科成绩需同时存储「原始分」与「赋分成绩」，二者独立留存，不可相互覆盖。
-  赋分触发条件：仅满足“考试类型为市统考”且“科目为政史地生四门选科”两个条件时，才生成并存储赋分成绩；其他场景仅存储原始分。
-  成绩唯一性：确保一个学生、一门课程、一次考试仅对应一条成绩记录，避免重复数据。

#### 3.3  赋分与排名规则

-  赋分规则：采用固定不可修改的赋分规则，基于学生单科市排名与有效参考总人数计算赋分成绩。
-  排名维度：市排名按「单科」独立统计，不跨科目、不跨班级合并排名，每个科目单独生成排名榜单。
-  数据关联：赋分成绩需与对应的原始分、市排名、有效参考人数关联存储，支持追溯赋分计算依据。

### 4.  基础数据管理需求

基础数据是系统运行的核心支撑，需满足完整存储、有效关联的需求，包括学生表、教职工表、课程表三大核心基础表。

#### 4.1  学生表需求

-  存储学生基础信息：学号（唯一标识）、姓名、性别、出生日期（可选）、当前年级、当前班级、高一行政班等。
-  数据关联：与班级表、选课记录表、考试成绩表建立有效关联，支持追溯学生的班级变迁、选科结果、成绩记录。
-  数据留存：学生信息一旦录入，不可随意删除，仅支持修改部分非核心信息（如联系方式），保障学生数据的连续性。

#### 4.2  教职工表需求

-  存储教职工基础信息：工号（唯一标识）、姓名、性别、职称、所授课程、是否离职、录入时间。
-  数据关联：与角色表、班级表建立有效关联，支持追溯教职工的角色分配、所带班级、所教课程。
-  状态管理：支持修改教职工「是否离职」状态，离职教职工信息留存，不可删除，保障教职工数据的完整性。

#### 4.3  课程表需求

-  存储课程基础信息：课程编号（唯一标识）、课程名称、课程类型（主科/选科）、是否参与赋分（仅政史地生为是）等。
-  数据关联：与考试成绩表、选课记录表建立有效关联，支持追溯课程的学生成绩、选科组合关联。
-  数据固定：高中9门核心课程信息固定录入，不可随意新增、删除，仅支持修改部分备注信息。

## 三、 数据需求分析

### 1.  核心实体识别

系统核心实体包括：学生、教职工、班级、课程、角色、选课记录、考试信息、考试成绩、账号。

### 2.  实体间核心关系

1.  学生与班级：多对一（一个班级包含多个学生，一个学生同一时间仅属于一个班级）
2.  教职工与角色：多对多（一个教职工可对应多个角色，一个角色可对应多个教职工，通过角色关联表实现）。
3.  教职工与班级：一对一（一个教职工只可担任一个班级班主任，一个班级仅对应一个班主任）。
4.  教职工与课程：多对多（一个教职工可教授多门课程，一门课程可由多个教职工教授）。
5.  学生与选课记录：一对一（一个高二学生仅对应一条选科记录）。
6.  考试与成绩：一对多（一次考试包含多条学生单科成绩记录）。
7.  课程与成绩：一对多（一门课程包含多条学生历次考试成绩记录）。

### 3.  数据完整性要求

1.  实体唯一性：每个核心实体需有唯一标识（如学生学号、教职工工号、成绩编号），避免数据重复。
2.  关联有效性：外键关联需确保引用的数据存在（如班主任工号必须对应教职工表中的有效工号），防止无效数据。
3.  非空约束：核心字段（如姓名、学号、课程名称）不可为空，保障数据的完整性。
4.  数据一致性：关联数据更新时需联动同步（如教职工工号修改，班级表中的班主任工号需同步更新），避免数据冲突。





# 概念设计(E-R图)







# 关系模型





# 功能实现

## 一. 班级与选课管理模块

###  1. 自动分班功能



## 二. 考试与成绩管理模块

### 1. 自动赋分功能

#### 赋分制度概述：

- 只有**市统考**类型的考试采取 “赋分制”，考生的成绩从高到低排序，根据人数比例划为 “A-E” 5个等级，各等级人数所占比例分别为 15%、35%、35%、13% 和 2%。
- 赋分区间：每个等级对应的分数区间如下：

​							A等级：100～86分

​							B等级：85～71分

​							C等级：70～56分

​							D等级：55～41分

​							E等级：40～30分

#### 赋分计算方式：

实际实现采用基于排名百分位的等级赋分制：

1. 首先根据学生原始成绩在考试中的排名确定所属等级
2. 然后在等级内根据排名位置计算具体分数
3. 使用RANK()函数处理同分同名次情况

计算公式：

- A等级(前15%)：$T = 100 - \frac{(排名百分位 - 0)}{15} \times 14$
- B等级(16%-50%)：$T = 85 - \frac{(排名百分位 - 15)}{35} \times 14$
- C等级(51%-85%)：$T = 70 - \frac{(排名百分位 - 50)}{35} \times 14$
- D等级(86%-98%)：$T = 55 - \frac{(排名百分位 - 85)}{13} \times 14$
- E等级(后2%)：$T = 40 - \frac{(排名百分位 - 98)}{2} \times 10$

其中，排名百分位 = $\frac{学生排名 \times 100.0}{总人数}$

### 2. 成绩排名功能



### 3. 修改成绩录入日志功能

当科任老师修改成绩后，会判断修改前后成绩是否一致，如果不一致则会将成绩基础信息、新旧成绩以及修改时间录入日志



## 三. 权限管理模块

相关函数在**sql\procedures\权限管理.py**文件中，核心是用python获取用户角色和相关权限，判断以下操作是否合法

关键函数：get_user_role_and_info，用于获取用户角色以及班级和课程id(如果有对应权限)

![image-20260115172243964](C:\Users\dogqo\AppData\Roaming\Typora\typora-user-images\image-20260115172243964.png)

![image-20260115172257510](C:\Users\dogqo\AppData\Roaming\Typora\typora-user-images\image-20260115172257510.png)

### 1. 查询成绩权限

向**query_score**函数提供目标学生的id和课程id，进行权限判断：

- 学生只能查看自己的成绩
- 获取目标学生班级，班主任只能查看自己班内学生成绩
- 科任老师只能查看所授课程的学生成绩
- 校长和教务主任可以看所有学生的成绩

权限判断通过才会返回目标的查询数据

### 2. 修改成绩权限

向**update_score**函数提供目标成绩id和新成绩，进行权限判断：

- 只有课程栏有有效课程的科任老师才能修改成绩
- 科任老师只能修改自己所教课程的成绩

权限判断通过才能完成修改成绩操作

### 3. 修改教职工信息权限

向**update_staff_info_api**函数提供目标职工id和修改数据，进行权限判断：

- 只有校长才能修改教职工表
- 校长只能修改职位是”校长“以外的教职工数据，且只能改职位、所教课程、是否离职这三项属性

权限判断通过才能完成修改教职工信息操作

## 四. 基础数据管理模块

### 班级视图



### 成绩视图




# 测试与总结

插入数据进行功能测试